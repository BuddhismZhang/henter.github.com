<?php
defined('IN_DC') or exit('Access Denied');
include atpl('header');
?>
<script >
function CheckedRev(fieldid, titleid)
{
	var fieldids = '#'+fieldid;
    var titleids = '#'+titleid;
    var inputfieldids = 'input[boxid='+fieldid+']';
    if($(fieldids).attr('checked')==false)
    {
        $(inputfieldids).attr('checked',true);
        $(titleids).val("取消全选");

    }
    else
    {
        $(inputfieldids).attr('checked',false);
        $(titleids).val("全选");
    }
}
</script>

    <div class="space">
        <div class="subtitle">系统备份的SQL文件</div>
        
<form method="post" id="myform" name="myform" >
<table class="maintable" border="0" cellspacing="0" cellpadding="0">
	<tr class="altbg1">
		<td width="8%">选中</td>
		<td>文件名</td>
		<td width="10%">文件大小</td>
		<td width="20%">备份时间</td>
		<td width="10%">卷号</td>
		<td width="15%">操作</td>
	</tr>
<?php

rsort($infos);

if(is_array($infos)){
	foreach($infos as $id => $info){
$id++;
?>
  <tr bgcolor="<?=$info['bgcolor']?>" >
    <td class="align_c"><input type="checkbox" name="filenames[]" value="<?=$info['filename']?>" id="sql_dc" boxid="sql_dc"></td>
    <td><a href="?mod=<?=$mod?>&file=<?=$file?>&action=down&filename=<?=$info['filename']?>"><?=$info['filename']?></a></td>
    <td class="align_c"><?=$info['filesize']?> M</td>
	<td class="align_c"><?=$info['maketime']?></td>
    <td class="align_c"><?=$info['number']?></td>
    <td class="align_c">
	<a href="?mod=<?=$mod?>&file=<?=$file?>&action=<?=$action?>&pre=<?=$info['pre']?>&dosubmit=1">导入</a> |
	<a href="?mod=<?=$mod?>&file=<?=$file?>&action=down&filename=<?=$info['filename']?>">下载</a>
	</td>
</tr>
<?php
	}
}
?>
</table>
<div class="button_box" style="padding-left:20px">
<input name='dc_all' title="全部" type='button' id='dc_all' onclick="CheckedRev('sql_dc','dc_all')"  value="全选" />
&nbsp;&nbsp;
	<select name="tocharset">
	<option value="">不进行字符集转换</option>
	<option value="gbk2utf-8">GBK 转 UTF-8</option>
	<option value="utf-82gbk">UTF-8 转 GBK</option>
	<option value="big52utf-8">BIG5 转 UTF-8</option>
	<option value="utf-82big5">UTF-8 转 BIG5</option>
	</select>
	<input type="submit" name="submit1" value=" 字符集转换 " title="转换完毕后以新字符集为前缀保存" onclick="document.myform.action='?mod=<?=$mod?>&file=<?=$file?>&action=changecharset'">
&nbsp;&nbsp;
    <input type="submit" name="submit2" value=" 删除选中的备份 " onclick="document.myform.action='?mod=<?=$mod?>&file=<?=$file?>&action=delete'">
</div>
</form>
</div>
        


    <div class="space">
        <div class="subtitle">非系统备份的SQL文件</div>
        
<form method="post" name="myform1" id="myform1" action="?mod=<?=$mod?>&file=<?=$file?>&action=delete">
<table class="maintable" border="0" cellspacing="0" cellpadding="0">
	<tr class="altbg1">
	<td>选中</td>
	<td>ID</td>
	<td>文件名</td>
	<td>文件大小</td>
	<td>备份时间</td>
	<td>操作</td>
	</tr>
<?php
if(is_array($others)){
	foreach($others as $id => $other){
$id++;
?>
  <tr class="altbg1">
    <td class="align_c">
    <input type="checkbox" name="filenames[]" value="<?=$other['filename']?>" id="sql_other" boxid="sql_other">
	</td>
    <td><?=$id?></td>
    <td><a href="?mod=<?=$mod?>&file=<?=$file?>&action=down&filename=<?=$other['filename']?>"><?=$other['filename']?></a></td>
    <td><?=$other['filesize']?> M</td>
	<td><?=$other['maketime']?></td>
    <td class="align_c">
	<a href="?mod=<?=$mod?>&file=<?=$file?>&action=<?=$action?>&filename=<?=$other['filename']?>&dosubmit=1">导入</a> |
	<a href="?mod=<?=$mod?>&file=<?=$file?>&action=down&filename=<?=$other['filename']?>">下载</a>
	</td>
</tr>
<?php
	}
}
?>
</table>
<div class="button_box" style="padding-left:20px">
<input name='other_all' type='button' id='other_all' onclick="CheckedRev('sql_other','other_all')"  value="全选" />
&nbsp;&nbsp;
   <select name="tocharset">
	<option value="">不进行字符集转换</option>
	<option value="gbk2utf-8">GBK 转 UTF-8</option>
	<option value="utf-82gbk">UTF-8 转 GBK</option>
	<option value="big52utf-8">BIG5 转 UTF-8</option>
	<option value="utf-82big5">UTF-8 转 BIG5</option>
	</select>
	<input type="submit" name="submit1" value=" 字符集转换 " title="转换完毕后以新字符集为前缀保存" onclick="document.myform1.action='?mod=<?=$mod?>&file=<?=$file?>&action=changecharset'">
&nbsp;&nbsp;
    <input type="submit" name="submit2" value=" 删除选中的备份 " onclick="document.myform1.action='?mod=<?=$mod?>&file=<?=$file?>&action=delete'">
</div>
</form>
</div>
        
        
    <div class="space">
        <div class="subtitle">上传数据库备份文件</div>
<form name="upload" method="post" action="?mod=<?=$mod?>&file=<?=$file?>&action=uploadsql" enctype="multipart/form-data">
<table class="maintable" border="0" cellspacing="0" cellpadding="0">
  <tr class="altbg1">
    <td>
	        上传SQL文件：
             <input name="uploadfile" type="file" size="25">
             <input type="hidden" name="MAX_FILE_SIZE" value="4096000">
             <input type="submit" name="submit" value=" 上传 "><br>只允许上传SQL格式的文件，上传成功后文件将自动在备份文件列表中显示
	</td>
  </tr>
</table>
</form>

</div>
    



<?php if(!function_exists("mb_convert_encoding")){ ?>
    <div class="space">
        <div class="subtitle">提示信息</div>
<table class="maintable" border="0" cellspacing="0" cellpadding="0">
  <tr class="altbg1">
    <td>强烈建议您加载PHP的mb_string扩展，否则此操作十分消耗资源（难以对大于1M的文件进行字符集转换）。</td>
  </tr>
</table>
        </div>
<?php } ?>

</body>
</html>